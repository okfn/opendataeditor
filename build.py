import PyInstaller.__main__
import os
import platform


def build_application():
    """Build an executable file for the Application."""
    system = platform.system()
    if system == "Darwin":  # macOS
        icon_path = "packaging/macos/icon.icns"
    elif system == "Windows":
        icon_path = "packaging/windows/icon.ico"
    elif system == "Linux":
        icon_path = "packaging/linux/icon.svg"

    print("Creating executable file for Open Data Editor")

    params = [
        "ode/main.py",
        "--windowed",  # Required for Windows install to not open a console.
        "--collect-all",
        "frictionless",  # Frictionless depends on data files
        "--collect-all",
        "ode",  # Collect all assets from Open Data Editor
        "--log-level",
        "WARN",
        "--name",
        "opendataeditor",
        "--noconfirm",
        "--icon",
        icon_path,
    ]

    PyInstaller.__main__.run(params)

    # Clean the spec file generated by PyInstaller
    os.remove("opendataeditor.spec")


if __name__ == "__main__":
    build_application()
